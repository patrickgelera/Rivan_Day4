Policy Based Firewall

### Deploy
- NetOps KRB Server
- WinServer 2022
- BLDG-PH
- BLDG-JP

### 2. Configuration
~~~
!@UTM-PH
conf t
 hostname UTM-PH
 enable secret pass
 service password-encryption
 no logging cons
 no ip domain lookup
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 int g1
  ip add 208.8.8.11 255.255.255.0
  no shut
 int g2
  ip add 192.168.102.11 255.255.255.0
  no shut
 int g3
  ip add 11.11.11.113 255.255.255.224
  ip add 11.11.11.133 255.255.255.224 secondary
  no shut
 !
 username admin privilege 15 secret pass
 ip http server
 ip http secure-server
 ip http authentication local
 end
wr
!
~~~

<br>

~~~
!@Win
ip: 11.11.11.100/27
gateway: 11.11.11.113
dns: 127.0.0.1

!@cmd
route add 208.8.8.0 mask 255.255.255.0 11.11.11.113
~~~

<br>

~~~
!@BLDG-PH
sudo su
ifconfig eth0 11.11.11.130 netmask 255.255.255.224 up
route add default gw 11.11.11.133
ping 11.11.11.133
~~~

<br>

~~~
!@BLDG-JP
sudo su
ifconfig eth0 208.8.8.12 netmask 255.255.255.0 up
route add default gw 208.8.8.11
ping 208.8.8.11
~~~



1. Define Zones and Interfaces

!@FW
conf t
 zone security OUTSIDE
  description PUBLIC_INTERFACE
 zone security INSIDE
  description LOCAL_LAN
 zone security DMZ
  description SECURE_PUB_SERVERS
 !
 int g1
  zone-member security OUTSIDE
 int g2
  zone-member security INSIDE
 int g3
  zone-member security DMZ
  end

2. Create an ACL to match traffic rules

!@FW
conf t
 ip access-list extended INSIDE-TO-OUTSIDE
  10 permit ip any any
 ip access-list extended OUTSIDE-TO-INSIDE
  10 deny ip any any
  end


3. Group traffic using Class Maps

!@FW
conf t
 class-map type inspect match-any CM-IN-TO-OUT
  match access-group name INSIDE-TO-OUTSIDE
 class-map type inspect match-any CM-OUT-TO-IN
  match access-group name OUTSIDE-TO-INSIDE
  end


4. Define Policy Maps to Act on the traffic (ex. inspect, drop, pass, log)

!@FW
conf t
 policy-map type inspect INSIDE-OUTSIDE-POLICY
  class class-default
   drop log
 policy-map type inspect OUTSIDE-INSIDE-POLICY
  class class-default
   drop log
   end


5. Define Zone-Pairs to link source and destination zone to policies in a specific direction.

!@FW
conf t
 zone-pair security INSIDE-OUTSIDE source INSIDE destination OUTSIDE
  service-policy type inspect INSIDE-OUTSIDE-POLICY
 zone-pair security OUTSIDE-INSIDE source OUTSIDE destination INSIDE
  service-policy type inspect OUTSIDE-INSIDE-POLICY
  end

 
 
=========================================================
Setup:

FIREWALL
CSR1000V
 
Create Zones 
- INSIDE
- OUTSIDE
- DMZ
 
Create a Policy for OUTSIDE-INSIDE : zero-trust deny any any

ALLOW-SERVICE INSIDE - OUTSIDE : INSPECT
ZERO-TRUST OUTSIDE - INSIDE : DROP
 
 In a Cisco zone-based firewall, inspect is stateful, allowing return traffic automatically by creating a connection state entry, 
 
 while pass is stateless and allows traffic in only one direction, requiring a separate policy for the return flow.
